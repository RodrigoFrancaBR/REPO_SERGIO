<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">
<ui:composition template="template/default/defaultLayout.xhtml">
	<f:metadata>
		<f:viewAction action="#{contratoBean.buscar()}" />
	</f:metadata>

	<ui:define name="content">
		<div class="table">
			<h:form id="form">
				<p:growl id="msgs" showDetail="true" />
				<p:messages id="messages" />

				<p:fieldset legend="Dados da contrato">

					<p:toolbar>
						<p:toolbarGroup>
							<p:commandButton value="Novo" action="#{contratoBean.novo()}"
								update="@form"></p:commandButton>

							<p:commandButton value="Salvar" action="#{contratoBean.salvar()}"
								rendered="#{contratoBean.inseri == true}" update="@form" />

							<p:commandButton value="Alterar"
								action="#{contratoBean.alterar()}"
								rendered="#{contratoBean.edita == true}" update="@form" />

							<p:commandButton value="Buscar" action="#{contratoBean.buscar()}"
								immediate="true" update="@form"></p:commandButton>

						</p:toolbarGroup>
					</p:toolbar>

					<br></br>

					<p:fieldset legend="Localizar Aluno por CPF"
						rendered="#{contratoBean.inseri}">
						<p:panelGrid columns="2">

							<p:commandButton value="Localizar"
								action="#{contratoBean.consultar()}" process="@this alunoCpf"
								update="formContrato" />

							<p:inputMask id="alunoCpf"
								value="#{contratoBean.entidade.aluno.cpf}" mask="999.999.999-99">
							</p:inputMask>

						</p:panelGrid>
					</p:fieldset>

					<p:panelGrid id="formContrato" columns="8"
						rendered="#{contratoBean.busca == false}">

						<p:outputLabel value="Aluno:" for="aluno" />
						<p:inputText id="aluno"
							value="#{contratoBean.entidade.aluno.nome}" readonly="true" />

						<p:outputLabel value="CPF:" for="cpf" />
						<p:inputText id="cpf" value="#{contratoBean.entidade.aluno.cpf}"
							readonly="true" />

						<p:outputLabel value="Taxa de Matrícula" for="tx" />
						<p:inputNumber id="tx"
							value="#{contratoBean.entidade.taxaMatricula}">
						</p:inputNumber>

						<p:outputLabel value="Valor do Curso:" for="vlCurso" />
						<p:inputNumber id="vlCurso" required="true"
							value="#{contratoBean.entidade.valorCurso}">
						</p:inputNumber>

						<p:outputLabel value="Valor do Material" for="vlMaterial" />
						<p:inputNumber id="vlMaterial" required="true"
							value="#{contratoBean.entidade.valorMaterial}">
						</p:inputNumber>

						<p:outputLabel value="Dia do Vencimento" for="venc" />
						<p:selectOneMenu id="venc"
							value="#{contratoBean.entidade.diaVencimento}">
							<f:selectItems value="#{contratoBean.dias}" var="dia"
								itemLabel="#{dia}" itemValue="#{dia}" />
						</p:selectOneMenu>

						<p:outputLabel value="Desconto" for="desc" />
						<p:selectOneMenu value="#{contratoBean.entidade.descontoCurso}"
							id="desc">
							<f:selectItem itemLabel="Sem Desconto" itemValue="0" />
							<f:selectItem itemLabel="10%" itemValue="0.1" />
							<f:selectItem itemLabel="20%" itemValue="0.2" />
							<f:selectItem itemLabel="30%" itemValue="0.3" />
							<f:selectItem itemLabel="100%" itemValue="1.00" />
						</p:selectOneMenu>

						<p:outputLabel value="Forma de Pagamento" for="formPagto" />
						<p:selectOneMenu value="#{contratoBean.entidade.formaDePagamento}"
							id="formPagto">
							<f:selectItem itemLabel="Dinheiro" itemValue="Dinheiro" />
							<f:selectItem itemLabel="Cheque" itemValue="Cheque" />
							<f:selectItem itemLabel="Cartão de Crédito"
								itemValue="Cartão de Crédito" />
							<f:selectItem itemLabel="Cartão de Débito"
								itemValue="Cartão de Débito" />
						</p:selectOneMenu>

						<p:outputLabel value="Data da Matrícula:" for="dt" />
						<p:calendar id="dt"
							value="#{contratoBean.entidade.dataMatricula.time}"
							pattern="dd/MM/yyyy" timeZone="America/Sao_Paulo" mask="true" />

						<p:outputLabel value="Situação da Matrícula" for="stMat" />
						<p:selectOneMenu
							value="#{contratoBean.entidade.situacaoMatricula}" id="stMat"
							disabled="true">
							<f:selectItem itemLabel="Processo de Matrícula"
								itemValue="Processo de Matrícula" />
						</p:selectOneMenu>

						<p:outputLabel value="Parcelas do Curso" for="parcCur" />
						<p:selectOneMenu value="#{contratoBean.entidade.qtdParcelasCurso}"
							id="parcCur">
							<f:selectItems value="#{contratoBean.entidade.qtdParcelas}"
								var="parcela" />
							<f:selectItem itemLabel="Ávista" itemValue="1" />
							<f:selectItem itemLabel="#{parcela}" itemValue="#{parcela}" />
						</p:selectOneMenu>

						<p:outputLabel value="Parcelas do Material" for="parcMat" />
						<p:selectOneMenu
							value="#{contratoBean.entidade.qtdParcelasMaterial}" id="parcMat">
							<f:selectItems value="#{contratoBean.entidade.qtdParcelas}"
								var="parcela" />
							<f:selectItem itemLabel="Ávista" itemValue="1" />
							<f:selectItem itemLabel="#{parcela}" itemValue="#{parcela}" />
						</p:selectOneMenu>

					</p:panelGrid>

					<p:dataTable value="#{contratoBean.entidades}" var="contrato"
						id="tabelacontratos" emptyMessage="Nenhum contrato" rows="8"
						paginator="true"
						paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}"
						rendered="#{contratoBean.busca == true}" editable="true">

						<f:facet name="header">contratos</f:facet>

						<p:ajax event="rowEdit" listener="#{contratoBean.onRowEdit}"
							update=":form:msgs" />

						<p:ajax event="rowEditCancel"
							listener="#{contratoBean.onRowCancel}" update=":form:msgs" />

						<p:column filterBy="#{contrato.aluno.nome}" headerText="Aluno"
							style="width: 70px;" filterStyle="width: -webkit-fill-available;">
							<h:outputText value="#{contrato.aluno.nome}" />
						</p:column>

						<p:column filterBy="#{contrato.matricula}" headerText="Matricula"
							style="width: 100px;"
							filterStyle="width: -webkit-fill-available;">
							<h:outputText value="#{contrato.matricula}" />
						</p:column>

						<p:column filterBy="#{contrato.taxaMatricula}" headerText="Taxa"
							style="width: 70px;" filterStyle="width: -webkit-fill-available;">
							<p:cellEditor>
								<f:facet name="output">
									<h:outputText value="#{contrato.taxaMatricula}">
										<f:convertNumber type="currency" locale="pt_BR" />
									</h:outputText>
								</f:facet>
								<f:facet name="input">
									<p:inputNumber value="#{contrato.taxaMatricula}"
										style="width:100%" />
								</f:facet>
							</p:cellEditor>
						</p:column>

						<p:column filterBy="#{contrato.valorCurso}" headerText="Curso"
							style="width: 70px;" filterStyle="width: -webkit-fill-available;">
							<p:cellEditor>
								<f:facet name="output">
									<h:outputText value="#{contrato.valorCurso}">
										<f:convertNumber type="currency" locale="pt_BR" />
									</h:outputText>
								</f:facet>
								<f:facet name="input">
									<p:inputNumber value="#{contrato.valorCurso}"
										style="width:100%" />
								</f:facet>
							</p:cellEditor>
						</p:column>

						<p:column filterBy="#{contrato.descontoCurso}"
							headerText="Desconto" style="width: 70px;"
							filterStyle="width: -webkit-fill-available;">
							<p:cellEditor>
								<f:facet name="output">
									<h:outputText value="#{contrato.descontoCurso}">
										<f:convertNumber type="percent" />
									</h:outputText>
								</f:facet>
								<f:facet name="input">
									<p:selectOneMenu value="#{contrato.descontoCurso}"
										id="desconto" style="width: 70px;">
										<f:selectItem itemLabel="Sem Desconto" itemValue="0" />
										<f:selectItem itemLabel="10%" itemValue="0.1" />
										<f:selectItem itemLabel="20%" itemValue="0.2" />
										<f:selectItem itemLabel="30%" itemValue="0.3" />
										<f:selectItem itemLabel="100%" itemValue="1.00" />
									</p:selectOneMenu>
								</f:facet>
							</p:cellEditor>
						</p:column>

						<p:column filterBy="#{contrato.qtdParcelasCurso}"
							headerText="Parcelas do Curso" style="width: 70px;"
							filterStyle="width: -webkit-fill-available;">
							<p:cellEditor>
								<f:facet name="output">
									<h:outputText
										value="#{contrato.qtdParcelasCurso==1?'Ávista': contrato.qtdParcelasCurso}" />
								</f:facet>
								<f:facet name="input">
									<p:selectOneMenu value="#{contrato.qtdParcelasCurso}"
										id="selParcCurso" style="width: 70px;">
										<f:selectItems value="#{contratoBean.entidade.qtdParcelas}"
											var="parcela" />
										<f:selectItem itemLabel="Ávista" itemValue="1" />
										<f:selectItem itemLabel="#{parcela}" itemValue="#{parcela}" />
									</p:selectOneMenu>
								</f:facet>
							</p:cellEditor>
						</p:column>

						<p:column filterBy="#{contrato.valorMaterial}"
							headerText="Material" style="width: 70px;"
							filterStyle="width: -webkit-fill-available;">
							<p:cellEditor>
								<f:facet name="output">
									<h:outputText value="#{contrato.valorMaterial}" />
								</f:facet>
								<f:facet name="input">
									<p:inputNumber value="#{contrato.valorMaterial}"
										style="width:100%" />
								</f:facet>
							</p:cellEditor>
						</p:column>

						<p:column filterBy="#{contrato.qtdParcelasMaterial}"
							headerText="Parcelas do Curso" style="width: 70px;"
							filterStyle="width: -webkit-fill-available;">
							<p:cellEditor>
								<f:facet name="output">
									<h:outputText
										value="#{contrato.qtdParcelasMaterial==1?'Ávista': contrato.qtdParcelasMaterial}" />
								</f:facet>
								<f:facet name="input">
									<p:selectOneMenu value="#{contrato.qtdParcelasMaterial}"
										id="selParcMat" style="width: 70px;">
										<f:selectItems value="#{contratoBean.entidade.qtdParcelas}"
											var="parcela" />
										<f:selectItem itemLabel="Ávista" itemValue="1" />
										<f:selectItem itemLabel="#{parcela}" itemValue="#{parcela}" />
									</p:selectOneMenu>
								</f:facet>
							</p:cellEditor>
						</p:column>


						<p:column filterBy="#{contrato.diaVencimento}"
							headerText="Vencimento" style="width: 70px;"
							filterStyle="width: -webkit-fill-available;">
							<p:cellEditor>
								<f:facet name="output">
									<h:outputText value="#{contrato.diaVencimento}" />
								</f:facet>
								<f:facet name="input">
									<p:selectOneMenu id="diaVenc" value="#{contrato.diaVencimento}"
										style="width: 70px;">
										<f:selectItems value="#{contratoBean.dias}" var="dia"
											itemLabel="#{dia}" itemValue="#{dia}" />
									</p:selectOneMenu>
								</f:facet>
							</p:cellEditor>
						</p:column>

						<p:column filterBy="#{contrato.formaDePagamento}"
							headerText="Forma de Pagamento" style="width: 100px;"
							filterStyle="width: -webkit-fill-available;">
							<p:cellEditor>
								<f:facet name="output">
									<h:outputText value="#{contrato.formaDePagamento}" />
								</f:facet>
								<f:facet name="input">
									<p:inputText value="#{contrato.formaDePagamento}"
										style="width:100%" />
								</f:facet>
							</p:cellEditor>
						</p:column>

						<p:column filterBy="#{contrato.dataMatricula}"
							headerText="Data da Matricula" style="width: 70px;"
							filterStyle="width: -webkit-fill-available;">
							<p:cellEditor>
								<f:facet name="output">
									<h:outputText value="#{contrato.dataMatricula.time}">
										<f:convertDateTime pattern="dd/MM/yyyy"
											timeZone="America/Sao_Paulo" />
									</h:outputText>
								</f:facet>
								<f:facet name="input">
									<p:calendar id="nasc"
										value="#{contrato.dataMatricula.time}"
										pattern="dd/MM/yyyy" timeZone="America/Sao_Paulo" mask="true" />
								</f:facet>
							</p:cellEditor>
						</p:column>

						<p:column filterBy="#{contrato.situacaoMatricula}"
							headerText="Situação da Matricula" style="width: 70px;"
							filterStyle="width: -webkit-fill-available;">
							<h:outputText value="#{contrato.situacaoMatricula}" />
						</p:column>

						<p:column style="width:35px">
							<p:rowEditor
								rendered="#{contrato.situacaoMatricula eq 'Processo de Matrícula'}" />
						</p:column>

					</p:dataTable>
				</p:fieldset>
			</h:form>
		</div>
	</ui:define>
</ui:composition>

</html>
