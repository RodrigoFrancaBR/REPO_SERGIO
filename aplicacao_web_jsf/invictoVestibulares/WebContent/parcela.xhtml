<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">
<ui:composition template="template/default/defaultLayout.xhtml">
	<f:metadata>
		<f:viewAction action="#{parcelaBean.buscar()}" />
	</f:metadata>

	<ui:define name="content">
		<div class="table">
			<h:form>

				<p:messages id="messages" />

				<p:fieldset legend="Dados da parcela">

					<p:toolbar>
						<p:toolbarGroup>
							<p:commandButton value="Novo" action="#{parcelaBean.novo()}"
								update="@form"></p:commandButton>

							<p:commandButton value="Salvar" action="#{parcelaBean.salvar()}"
								disabled="#{parcelaBean.busca == true}" update="@form"></p:commandButton>

							<p:commandButton value="Buscar" action="#{parcelaBean.buscar()}"
								immediate="true" update="@form"></p:commandButton>

						</p:toolbarGroup>
					</p:toolbar>

					<br></br>

					<p:fieldset legend="Localizar Matricula"
						rendered="#{parcelaBean.inseri}">
						<p:panelGrid columns="2">

							<p:commandButton value="Localizar"
								action="#{parcelaBean.consultar()}"
								process="@this alunoMatricula" update="tabelaparcelas1" />

							<p:inputMask id="alunoMatricula"
								value="#{parcelaBean.entidade.contrato.matricula}"
								mask="9999999.999.999-99">
							</p:inputMask>
						</p:panelGrid>
					</p:fieldset>

					<p:dataTable value="#{parcelaBean.entidade.contrato.parcelas}"
						var="parcela" id="tabelaparcelas1" emptyMessage="Nenhum parcela"
						rows="8" paginator="true"
						paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}"
						rendered="#{parcelaBean.inseri == true}">

						<f:facet name="header">Parcelas</f:facet>

						<p:column filterBy="#{parcelaBean.entidade.contrato.aluno.nome}"
							headerText="Aluno" 
							filterStyle="width: -webkit-fill-available;">
							<h:outputText value="#{parcelaBean.entidade.contrato.aluno.nome}" />
						</p:column>

						<p:column filterBy="#{parcelaBean.entidade.contrato.matricula}"
							headerText="Matricula" 
							filterStyle="width: -webkit-fill-available;">
							<h:outputText value="#{parcelaBean.entidade.contrato.matricula}" />
						</p:column>

						<p:column filterBy="#{parcela.numeroDaParcelaCurso}"
							headerText="Parcela Curso" 
							filterStyle="width: -webkit-fill-available;">
							<!-- <h:outputText value="#{parcela.numeroDaParcelaCurso}"/> -->
							<h:outputText
								value="#{parcelaBean.entidade.contrato.condicaoDoContrato.toString().equals('CursoMaterialAvista')?'Ávista': parcelaBean.entidade.contrato.condicaoDoContrato.toString().equals('CursoAvistaMaterialParcelado')?'Ávista': parcela.numeroDaParcelaCurso}" />						
						</p:column>

						<p:column filterBy="#{parcela.numeroDaParcelaMaterial}"
							headerText="Parcela Material" 
							filterStyle="width: -webkit-fill-available;">
							<h:outputText
								value="#{parcelaBean.entidade.contrato.condicaoDoContrato.toString().equals('CursoMaterialAvista')?'Ávista': parcelaBean.entidade.contrato.condicaoDoContrato.toString().equals('MaterialAvistaCursoParcelado')?'Ávista': parcela.numeroDaParcelaMaterial}" />							
						</p:column>

						<p:column filterBy="#{parcela.dataVencimento}"
							headerText="Vencimento" 
							filterStyle="width: -webkit-fill-available;">
							<h:outputText value="#{parcela.dataVencimento.time}">
								<f:convertDateTime pattern="dd/MM/yyyy"
									timeZone="America/Sao_Paulo" />
							</h:outputText>
						</p:column>


						<p:column filterBy="#{parcela.valorPago}" headerText="Pago"
							 filterStyle="width: -webkit-fill-available;">
							<h:outputText value="#{parcela.valorPago}">
								<f:convertNumber type="currency" locale="pt_BR" />
							</h:outputText>
						</p:column>

						<p:column filterBy="#{parcela.dataPagamento}"
							headerText="Pagamento" 
							filterStyle="width: -webkit-fill-available;">
							<h:outputText
								value="#{parcela.dataPagamento.time==null?'Aguardando Pagamento': parcela.dataPagamento.time}">
								<!-- <h:outputText value="#{parcela.dataPagamento.time}"> -->
								<f:convertDateTime pattern="dd/MM/yyyy"
									timeZone="America/Sao_Paulo" />
							</h:outputText>
						</p:column>

						<p:column filterBy="#{parcela.valorDaParcelaDoCurso}"
							headerText="Parcela Curso" 
							filterStyle="width: -webkit-fill-available;">
							<h:outputText value="#{parcela.valorDaParcelaDoCurso}">
								<f:convertNumber type="currency" locale="pt_BR" />
							</h:outputText>
						</p:column>

						<p:column filterBy="#{parcela.valorDaParcelaDoMaterial}"
							headerText="Parcela Material" 
							filterStyle="width: -webkit-fill-available;">
							<h:outputText value="#{parcela.valorDaParcelaDoMaterial}">
								<f:convertNumber type="currency" locale="pt_BR" />
							</h:outputText>
						</p:column>

						<p:column filterBy="#{parcela.taxaMatricula}" headerText="Taxa"
							 filterStyle="width: -webkit-fill-available;">
							<h:outputText value="#{parcela.taxaMatricula}">
								<f:convertNumber type="currency" locale="pt_BR" />
							</h:outputText>
						</p:column>

						<p:column filterBy="#{parcela.valorResidualDaParcelaCurso}"
							headerText="Residual Curso" 
							filterStyle="width: -webkit-fill-available;">
							<h:outputText value="#{parcela.valorResidualDaParcelaCurso}">
								<f:convertNumber type="currency" locale="pt_BR" />
							</h:outputText>
						</p:column>

						<p:column filterBy="#{parcela.valorResidualDaParcelMaterial}"
							headerText="Residual Material" 
							filterStyle="width: -webkit-fill-available;">
							<h:outputText value="#{parcela.valorResidualDaParcelaMaterial}">
								<f:convertNumber type="currency" locale="pt_BR" />
							</h:outputText>
						</p:column>

						<p:column filterBy="#{parcela.valorTotalDaParcela}"
							headerText="Total" 
							filterStyle="width: -webkit-fill-available;">
							<h:outputText value="#{parcela.valorTotalDaParcela}">
								<f:convertNumber type="currency" locale="pt_BR" />
							</h:outputText>
						</p:column>

						<p:column filterBy="#{parcela.situacaoDaParcela}"
							headerText="Situação" 
							filterStyle="width: -webkit-fill-available;">
							<h:outputText value="#{parcela.situacaoDaParcela}" />
						</p:column>

						<p:column filterBy="#{parcela.numeroDaParcela}"
							headerText="Parcela" 
							filterStyle="width: -webkit-fill-available;">
							<h:outputText value="#{parcela.numeroDaParcela}" />
						</p:column>
					</p:dataTable>

					<p:dataTable value="#{parcelaBean.entidades}" var="parcela"
						id="tabelaparcelas" emptyMessage="Nenhum parcela" rows="8"
						paginator="true"
						paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}"
						rendered="#{parcelaBean.busca == true}">

						<f:facet name="header">Parcelas</f:facet>

						<p:column filterBy="#{parcela.contrato.aluno.nome}"
							headerText="Aluno" 
							filterStyle="width: -webkit-fill-available;">
							<h:outputText value="#{parcela.contrato.aluno.nome}" />
						</p:column>

						<p:column filterBy="#{parcela.contrato.matricula}"
							headerText="Matricula" 
							filterStyle="width: -webkit-fill-available;">
							<h:outputText value="#{parcela.contrato.matricula}" />
						</p:column>

						<p:column filterBy="#{parcela.dataVencimento.time}"
							headerText="Vencimento" 
							filterStyle="width: -webkit-fill-available;">
							<h:outputText value="#{parcela.dataVencimento.time}">
								<f:convertDateTime pattern="dd/MM/yyyy"
									timeZone="America/Sao_Paulo" />
							</h:outputText>
						</p:column>


						<p:column filterBy="#{parcela.valorPago}" headerText="Pago"
							 filterStyle="width: -webkit-fill-available;">
							<h:outputText value="#{parcela.valorPago}">
								<f:convertNumber type="currency" locale="pt_BR" />
							</h:outputText>
						</p:column>

						<p:column filterBy="#{parcela.dataPagamento}"
							headerText="Pagamento" 
							filterStyle="width: -webkit-fill-available;">
							<h:outputText
								value="#{parcela.dataPagamento.time==null?'Aguardando Pagamento': parcela.dataPagamento.time}">								
								<f:convertDateTime pattern="dd/MM/yyyy"
									timeZone="America/Sao_Paulo" />
							</h:outputText>
						</p:column>					

						<p:column filterBy="#{parcela.valorTotalDaParcela}"
							headerText="Total" 
							filterStyle="width: -webkit-fill-available;">
							<h:outputText value="#{parcela.valorTotalDaParcela}">
								<f:convertNumber type="currency" locale="pt_BR" />
							</h:outputText>
						</p:column>

						<p:column filterBy="#{parcela.situacaoDaParcela}"
							headerText="Situação" 
							filterStyle="width: -webkit-fill-available;">
							<h:outputText value="#{parcela.situacaoDaParcela}" />
						</p:column>

						<p:column filterBy="#{parcela.numeroDaParcela}"
							headerText="Parcela" 
							filterStyle="width: -webkit-fill-available;">
							<h:outputText value="#{parcela.numeroDaParcela}" />
						</p:column>

						<p:column>
							<f:facet name="header">Receber Pagamento</f:facet>
							<h:commandLink rendered="#{!parcela.situacaoDaParcela.equals('Pago')}" value="Receber Pagamento"
								action="#{parcelaBean.receberPagamento(parcela)}" update="tabelaparcelas" />
						</p:column>
					</p:dataTable>
				</p:fieldset>
			</h:form>
		</div>
	</ui:define>
</ui:composition>

</html>
